<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Spending Money (Monthly)</title>
<link rel="manifest" href="manifest.webmanifest">
<meta name="theme-color" content="#111827">
<script>if('serviceWorker' in navigator){navigator.serviceWorker.register('./sw.js').catch(console.error)}</script>
<style>
:root{--b:#111827;--g:#6b7280;--bg:#f9fafb;--bd:#e5e7eb}
*{box-sizing:border-box} body{font-family:system-ui,Segoe UI,Roboto,Arial,sans-serif;margin:0;background:var(--bg);color:var(--b)}
.wrap{max-width:760px;margin:32px auto;padding:0 16px}
.card{background:#fff;border:1px solid var(--bd);border-radius:16px;padding:16px;box-shadow:0 1px 2px rgba(0,0,0,.05);margin:12px 0}
h1{font-size:clamp(20px,3.2vw,28px);margin:6px 0 4px} .muted{color:var(--g)}
label{display:block;margin:.5rem 0 .25rem;font-weight:600}
input[type=text],input[type=number]{width:100%;padding:.65rem .75rem;border:1px solid var(--bd);border-radius:12px;font-size:16px}
.row{display:grid;grid-template-columns:1fr 140px 120px 110px;gap:10px;align-items:end}
.btn{background:#111827;color:#fff;border:1px solid #111827;border-radius:12px;padding:.65rem .9rem;font-weight:600;cursor:pointer}
.btn_secondary{background:#fff;color:var(--b);border:1px solid var(--bd)}
table{width:100%;border-collapse:separate;border-spacing:0;margin-top:8px}
th,td{padding:10px;border-bottom:1px solid var(--bd);text-align:left;font-size:15px}
td:last-child{text-align:right}
.totals{display:flex;gap:10px;flex-wrap:wrap} .pill{flex:1;min-width:160px;border:1px solid var(--bd);border-radius:14px;background:#fff;padding:12px}
.tabs{position:sticky;bottom:0;background:#fff;border-top:1px solid var(--bd);display:flex;gap:8px;padding:10px 12px}
.tabs a{flex:1;text-align:center;text-decoration:none;border:1px solid var(--bd);border-radius:10px;padding:10px 0;color:var(--b);font-weight:600}
.tabs a.active{background:#111827;color:#fff;border-color:#111827}
</style>
</head>
<body>
<div class="wrap">
  <div class="card">
    <h1>Spending Money (Monthly)</h1>
    <label for="budget">Monthly spending money (AUD)</label>
    <input id="budget" type="number" inputmode="decimal" placeholder="e.g. 1200"/>
    <div style="display:flex;gap:8px;margin-top:8px">
      <button id="reset" class="btn_secondary btn">Reset month</button>
      <button id="copy" class="btn_secondary btn">Copy summary</button>
    </div>
  </div>

  <div class="card">
    <div class="row">
      <div>
        <label for="desc">Entry</label>
        <input id="desc" type="text" placeholder="e.g. Groceries"/>
      </div>
      <div>
        <label for="amount">Amount (AUD)</label>
        <input id="amount" type="number" inputmode="decimal" placeholder="e.g. 75.50"/>
      </div>
      <div>
        <label for="sub">Subtract?</label>
        <input id="sub" type="checkbox"/> <span class="muted">tick to subtract</span>
      </div>
      <button id="add" class="btn">Add</button>
    </div>

    <table id="list">
      <thead><tr><th style="width:110px">Date</th><th>Entry</th><th style="width:120px">Amount</th><th style="width:62px"></th></tr></thead>
      <tbody></tbody>
    </table>
    <p class="muted" id="empty" style="margin:12px 0 0">No entries yet.</p>
  </div>

  <div class="card">
    <div class="totals">
      <div class="pill"><div class="muted">Budget (month)</div><div id="t_budget">$0.00</div></div>
      <div class="pill"><div class="muted">Spent</div><div id="t_spent">$0.00</div></div>
      <div class="pill"><div class="muted">Remaining</div><div id="t_left">$0.00</div></div>
    </div>
  </div>
</div>

<nav class="tabs">
  <a href="./" class="active">Spending</a>
  <a href="./food/">Food</a>
  <a href="./savings/">Savings</a>
</nav>

<script>
const C = new Intl.NumberFormat('en-AU',{style:'currency',currency:'AUD'});
const KEY='spend_v1';
const els={budget:budget,desc:desc,amount:amount,sub:sub,add:add,reset:reset,copy:copy,tbody:document.querySelector('#list tbody'),empty:empty,tb:t_budget,ts:t_spent,tl:t_left};
let state=load()||{budget:0,items:[]};
function load(){try{return JSON.parse(localStorage.getItem(KEY))}catch(e){return null}}
function save(){localStorage.setItem(KEY,JSON.stringify(state))}
function fmt(n){return C.format(Number(n||0))}
function today(){return new Date().toISOString().slice(0,10)}
function escapeHtml(s){return (s||'').replace(/[&<>"']/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]))}
function render(){
  const spent=state.items.reduce((s,i)=>s+Number(i.amount||0),0);
  els.tb.textContent=fmt(state.budget||0);
  els.ts.textContent=fmt(spent);
  els.tl.textContent=fmt((Number(state.budget||0)-spent));
  els.budget.value=state.budget||'';
  els.tbody.innerHTML='';
  els.empty.style.display=state.items.length?'none':'block';
  state.items.slice().sort((a,b)=>b.date.localeCompare(a.date)).forEach((i,idx)=>{
    const tr=document.createElement('tr');
    const delIdx=state.items.indexOf(i);
    tr.innerHTML=`<td>${i.date}</td><td>${escapeHtml(i.desc||'')}</td><td>${fmt(i.amount)}</td><td><button data-del="${delIdx}" class="btn_secondary" style="padding:.35rem .6rem">Del</button></td>`;
    els.tbody.appendChild(tr);
  });
}
els.add.addEventListener('click',()=>{
  const d=els.desc.value.trim(); const v=Number(els.amount.value);
  if(!d||!isFinite(v))return; const val=els.sub.checked? -Math.abs(v):Math.abs(v);
  state.items.push({date:today(),desc:d,amount:+val.toFixed(2)});
  els.desc.value=''; els.amount.value=''; els.sub.checked=false; save(); render();
});
els.budget.addEventListener('change',()=>{const v=Number(els.budget.value); state.budget=isFinite(v)?+v.toFixed(2):0; save(); render();});
els.reset.addEventListener('click',()=>{if(!confirm('Reset this month? This clears entries and budget.'))return; state={budget:0,items:[]}; save(); render();});
els.copy.addEventListener('click',()=>{
  const spent=state.items.reduce((s,i)=>s+Number(i.amount||0),0);
  const left=(Number(state.budget||0)-spent);
  const lines=['Spending (Monthly)',`Budget: ${fmt(state.budget||0)}`,`Spent:  ${fmt(spent)}`,`Remaining: ${fmt(left)}`,'','Entries:',...state.items.map(i=>`${i.date} â€“ ${i.desc}: ${fmt(i.amount)}`)];
  navigator.clipboard.writeText(lines.join('\n')).then(()=>alert('Summary copied.'));
});
document.querySelector('#list tbody').addEventListener('click',(e)=>{
  const b=e.target.closest('[data-del]'); if(!b)return;
  const idx=Number(b.getAttribute('data-del')); const it=state.items[idx]; if(!it)return;
  if(!confirm(`Delete "${it.desc}" for ${fmt(it.amount)}?`))return;
  state.items.splice(idx,1); save(); render();
});
render();
</script>
</body></html>
