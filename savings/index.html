<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Savings – House Deposit</title>

<link rel="manifest" href="../manifest.webmanifest">
<meta name="theme-color" content="#111827">
<script>
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('../sw.js').catch(console.error);
  }
</script>

<style>
  :root{--b:#111827;--g:#6b7280;--bg:#f9fafb;--brand:#111827;--ok:#16a34a;--warn:#ef4444}
  *{box-sizing:border-box}
  body{font-family:system-ui,apple-system,Segoe UI,Roboto,Arial,sans-serif;margin:0;background:var(--bg);color:#111}
  .wrap{max-width:760px;margin:16px auto;padding:0 16px; padding-bottom:128px;}
  .card{background:#fff;border:1px solid #eee;border-radius:16px;padding:16px;box-shadow:0 1px 2px rgba(0,0,0,.05);margin:12px 0}
  h1{font-size:clamp(20px,3.2vw,28px);margin:6px 0 4px;color:var(--b)}
  .muted{color:var(--g)}

  label{display:block;margin:.5rem 0 .25rem;color:var(--b);font-weight:600}
  input{width:100%;padding:.75rem;border:1px solid #e5e7eb;border-radius:12px;font-size:16px}
  .row{display:grid;grid-template-columns:1fr 1fr;gap:10px;align-items:end}
  .row3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px}
  .btn{display:inline-block;background:var(--brand);color:#fff;border:none;border-radius:12px;padding:.65rem 1rem;font-weight:700;cursor:pointer}
  .btn.secondary{background:#fff;color:var(--b);border:1px solid #e5e7eb}
  .table{width:100%;border-collapse:separate;border-spacing:0;margin-top:10px}
  .table th,.table td{padding:10px;border-bottom:1px solid #eee;text-align:left}
  .table th:last-child,.table td:last-child{text-align:right}
  .pill{display:inline-block;font-weight:700}
  .pill.ok{color:var(--ok)}
  .pill.bad{color:var(--warn)}
  progress{width:100%;height:12px;border:0;border-radius:6px;background:#eee}
  progress::-webkit-progress-bar{background:#eee;border-radius:6px}
  progress::-webkit-progress-value{background:#111827;border-radius:6px}

  .tabs{position:fixed;left:0;right:0;bottom:0;background:#fff;border-top:1px solid #eee;display:flex;gap:8px;padding:10px 12px;z-index:9999}
  .tabs a{flex:1;text-align:center;text-decoration:none;border:1px solid #eee;border-radius:12px;padding:12px 0;color:#111827;font-weight:700;-webkit-tap-highlight-color:transparent}
  .tabs a.active{background:#111827;color:#fff;border-color:#111827}

  .fab{position:fixed;right:16px;bottom:76px;z-index:10000;background:#111827;color:#fff;border:none;border-radius:28px;height:56px;min-width:56px;padding:0 18px;font-weight:800;font-size:16px;display:flex;align-items:center;gap:10px;box-shadow:0 8px 24px rgba(0,0,0,.18);cursor:pointer}
  .fab span{font-size:22px;line-height:1}
</style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>House Deposit Savings</h1>
      <p class="muted">Add deposits (positive) or withdrawals (negative). We’ll track progress vs house price and target %.</p>

      <div class="row">
        <div>
          <label for="house">House price (AUD)</label>
          <input id="house" inputmode="decimal" placeholder="e.g. 650000" />
        </div>
        <div>
          <label for="targetPct">Target deposit %</label>
          <input id="targetPct" inputmode="decimal" placeholder="e.g. 20" />
        </div>
      </div>
      <div style="display:flex;gap:8px;margin-top:8px">
        <button class="btn" onclick="saveMeta()">Save</button>
        <button class="btn secondary" onclick="resetAll()">Reset savings</button>
      </div>
    </div>

    <div class="card">
      <div class="row3">
        <div>
          <label for="desc">Entry</label>
          <input id="desc" placeholder="e.g. Pay savings" />
        </div>
        <div>
          <label for="amount">Amount (AUD)</label>
          <input id="amount" inputmode="decimal" placeholder="e.g. 500 or -50" />
        </div>
        <div>
          <label>&nbsp;</label>
          <button class="btn" style="width:100%" onclick="addEntry()">Add entry</button>
        </div>
      </div>

      <table class="table" id="list">
        <thead><tr><th>Date</th><th>Entry</th><th>Amount</th><th></th></tr></thead>
        <tbody></tbody>
      </table>
    </div>

    <div class="card">
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:12px">
        <div><div class="muted">Total saved</div><div id="tSaved">$0</div></div>
        <div><div class="muted">% of house price</div><div id="tPct">0%</div></div>
      </div>
      <progress id="pOverall" value="0" max="100"></progress>
      <div class="muted" style="margin-top:8px">
        Target: <span id="tTarget">$0</span> (<span id="tTargetPct">0%</span>) — Remaining to target: <span id="tRemainTarget">$0</span>
      </div>
    </div>
  </div>

  <!-- Extra floating Add so it’s always on screen too -->
  <button class="fab" onclick="addEntry()"><span>＋</span> Add</button>

  <nav class="tabs">
    <a href="../">Spending</a>
    <a href="../food/">Food</a>
    <a class="active" href="./">Savings</a>
  </nav>

<script>
const KEY='savings-v3';

let state = {
  house: 0,
  targetPct: 20,
  items: [] // {id,date,desc,amount}
};

function fmt(n){ return (n<0?'-':'') + '$' + Math.abs(n).toFixed(2); }

function load(){
  try{ const s=JSON.parse(localStorage.getItem(KEY)); if(s) state=s; }catch(e){}
  document.getElementById('house').value = state.house || '';
  document.getElementById('targetPct').value = state.targetPct ?? '';
  render();
}
function save(){ localStorage.setItem(KEY, JSON.stringify(state)); }
function saveMeta(){
  state.house = Number(document.getElementById('house').value||0);
  state.targetPct = Number(document.getElementById('targetPct').value||0);
  save(); render();
}
function addEntry(){
  const desc = document.getElementById('desc').value.trim();
  const amount = Number(document.getElementById('amount').value||0);
  if(!desc){ alert('Please type an entry'); return; }
  state.items.unshift({ id:Date.now(), date:new Date().toISOString().slice(0,10), desc, amount });
  document.getElementById('desc').value='';
  document.getElementById('amount').value='';
  save(); render();
}
function delItem(id){
  if(!confirm('Delete this entry?')) return;
  state.items = state.items.filter(x=>x.id!==id); save(); render();
}
function resetAll(){
  if(!confirm('Reset all savings? This clears entries and numbers.')) return;
  state={house:0,targetPct:20,items:[]}; save(); render();
}
function render(){
  // table
  const tb=document.querySelector('#list tbody'); tb.innerHTML='';
  state.items.forEach(i=>{
    const tr=document.createElement('tr');
    tr.innerHTML = `<td>${i.date}</td><td>${i.desc}</td><td>${fmt(i.amount)}</td>
                    <td><button class="btn secondary" onclick="delItem(${i.id})">Delete</button></td>`;
    tb.appendChild(tr);
  });

  const saved = state.items.reduce((s,i)=>s+Number(i.amount||0),0);
  const pct = state.house>0 ? (saved/state.house*100) : 0;
  const targetAmount = state.house * (Number(state.targetPct||0)/100);
  const remainToTarget = Math.max(0, targetAmount - saved);

  document.getElementById('tSaved').textContent = fmt(saved);
  document.getElementById('tPct').textContent = (pct).toFixed(2)+'%';
  document.getElementById('pOverall').value = Math.max(0, Math.min(100, pct));

  document.getElementById('tTarget').textContent = fmt(targetAmount||0);
  document.getElementById('tTargetPct').textContent = (Number(state.targetPct||0)).toFixed(0)+'%';
  document.getElementById('tRemainTarget').textContent = fmt(remainToTarget);
}

load();
</script>
</body>
</html>
